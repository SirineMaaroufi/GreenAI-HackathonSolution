# NEW WORKFLOW - Separated Simulation & Analysis

## ğŸ“‹ Two-Stage Process

The system now separates **building physics simulation** from **AI agent analysis** for better efficiency and flexibility.

### Why This Change?
âœ… **Run simulation once** - Don't repeat expensive building physics calculations  
âœ… **Faster agent testing** - Test different agent configurations on same data  
âœ… **Focused analysis** - AI agents analyze 5 key time points instead of every hour  
âœ… **Realistic** - Matches how real systems work (historical data + periodic analysis)

---

## ğŸš€ Complete Workflow

### STAGE 1: Building Physics Simulation (Run Once)

```bash
python simulate_building_data.py
```

**What it does:**
- Simulates 30 days of building energy consumption
- Every hour for all 8 zones
- Rule-based HVAC control (no AI agents)
- Saves to: `building_simulation_data.csv`

**Options:**
```bash
python simulate_building_data.py 7              # 7 days
python simulate_building_data.py 30             # 30 days (default)
python simulate_building_data.py 30 my_sim.csv  # Custom filename
```

**Output:** `building_simulation_data.csv`
- timestamp, zone_id, zone_name
- indoor_temp, hvac_setpoint, occupancy
- total_consumption, solar_used, grid_used
- electricity_price, grid_carbon_intensity
- ~86,400 rows for 30 days (8 zones Ã— 30 days Ã— 24 hours Ã— 4 quarters)

**Time:** ~5-10 minutes for 30 days

---

### STAGE 2: AI Agent Analysis (Run Multiple Times)

```bash
python main_multizone.py
```

**What it does:**
- Loads pre-simulated data from `building_simulation_data.csv`
- Selects 5 representative timepoints:
  - 08:00 (Morning start)
  - 10:00 (Mid-morning)
  - 12:00 (Lunch/noon)
  - 15:00 (Afternoon)
  - 18:00 (Evening)
- Runs full AI agent analysis on each timepoint
- Generates optimization recommendations

**Output Files:**
- `agent_recommendations.csv` - AI agent recommendations for each zone
- `zone_alerts.csv` - Anomalies detected by Sherlock

**Time:** ~10-15 minutes (5 timepoints Ã— 8 zones Ã— 5 agents)

---

## ğŸ“Š Typical Usage Patterns

### Pattern 1: Initial Setup & Analysis
```bash
# Step 1: Generate forecast data (if not exists)
python generate_zone_data.py 30

# Step 2: Run building simulation
python simulate_building_data.py 30

# Step 3: Run AI agent analysis
python main_multizone.py

# Step 4: Visualize (if needed)
python visualize_zones.py
```

### Pattern 2: Test Different Agent Configurations
```bash
# Simulate once
python simulate_building_data.py 30

# Test different agent settings multiple times
python main_multizone.py  # Run 1: Default settings
# (Edit agent parameters)
python main_multizone.py  # Run 2: Modified settings
# (Edit agent parameters again)
python main_multizone.py  # Run 3: New settings

# Compare results from different runs
```

### Pattern 3: Different Scenarios
```bash
# Scenario A: Normal conditions
python generate_zone_data.py 7
python simulate_building_data.py 7 scenario_normal.csv
python main_multizone.py  # Update to load scenario_normal.csv

# Scenario B: Heatwave (edit zone_data_generator for higher temps)
python generate_zone_data.py 7
python simulate_building_data.py 7 scenario_heatwave.csv
python main_multizone.py  # Update to load scenario_heatwave.csv
```

---

## ğŸ“ File Structure

```
hackathon/
â”œâ”€â”€ STAGE 1: Simulation Inputs
â”‚   â”œâ”€â”€ zone_forecast_data.csv          [Generated by generate_zone_data.py]
â”‚   â”œâ”€â”€ building_zones.py               [Zone definitions]
â”‚   â””â”€â”€ zone_data_generator.py          [Data generation logic]
â”‚
â”œâ”€â”€ STAGE 1: Simulation Script
â”‚   â””â”€â”€ simulate_building_data.py       [Run building physics]
â”‚
â”œâ”€â”€ STAGE 1: Simulation Output
â”‚   â””â”€â”€ building_simulation_data.csv    [Pre-simulated data - reusable]
â”‚
â”œâ”€â”€ STAGE 2: Analysis Scripts
â”‚   â”œâ”€â”€ main_multizone.py               [AI agent analysis]
â”‚   â””â”€â”€ agents/                         [AI agent implementations]
â”‚
â”œâ”€â”€ STAGE 2: Analysis Outputs
â”‚   â”œâ”€â”€ agent_recommendations.csv       [AI recommendations]
â”‚   â””â”€â”€ zone_alerts.csv                 [Anomaly alerts]
â”‚
â””â”€â”€ Optional: Visualization
    â”œâ”€â”€ visualize_zones.py              [Create dashboard]
    â””â”€â”€ multizone_dashboard.png         [Visual output]
```

---

## ğŸ¯ Analysis Timepoints

The system analyzes **5 strategic timepoints** per day:

| Time  | Period        | Why Selected |
|-------|---------------|--------------|
| 08:00 | Morning       | Classes start, occupancy rises |
| 10:00 | Mid-Morning   | Peak occupancy, high solar |
| 12:00 | Noon          | Cafeteria peak, max solar |
| 15:00 | Afternoon     | High consumption, solar declining |
| 18:00 | Evening       | Shift to dorms, peak electricity prices |

These represent different operating conditions and optimization opportunities.

---

## ğŸ”§ Customization

### Change Analysis Timepoints

Edit `main_multizone.py`:
```python
# In select_analysis_timepoints function
target_hours = [8, 10, 12, 15, 18]  # Change to your desired hours
```

### Analyze Specific Date/Time

Edit `main_multizone.py` to filter by specific dates:
```python
# After loading simulation_data
specific_date = pd.to_datetime('2024-03-20')
simulation_data = simulation_data[
    simulation_data['timestamp'].dt.date == specific_date.date()
]
```

### Extend Simulation Period

```bash
python simulate_building_data.py 60  # 2 months
python simulate_building_data.py 90  # 3 months
```

---

## ğŸ’¡ Benefits of This Approach

### Efficiency
- Simulation: 5-10 min (once)
- Analysis: 10-15 min (repeatable)
- vs Old: 30-40 min every time

### Flexibility
- Test different AI agent parameters
- Compare optimization strategies
- Run "what-if" scenarios

### Realism
- Matches real building management systems
- Historical data + periodic AI analysis
- Not real-time (which isn't realistic for Ollama anyway)

### Development
- Debug agents without re-simulating
- Consistent data for testing
- Faster iteration cycles

---

## ğŸ“Š Output Comparison

### building_simulation_data.csv (Stage 1)
```
timestamp,zone_id,indoor_temp,occupancy,consumption,hvac_setpoint...
2024-03-15 08:00,engineering,22.1,85,120.5,22.0...
2024-03-15 08:00,library,21.8,145,95.3,22.0...
...30 days Ã— 24 hours Ã— 4 quarters Ã— 8 zones = ~86,400 rows
```

### agent_recommendations.csv (Stage 2)
```
timestamp,zone_id,current_setpoint,recommended_setpoint,reasoning...
2024-03-15 08:00,engineering,22.0,21.5,"Pre-cool using solar surplus"...
2024-03-15 08:00,library,22.0,22.0,"Maintain for comfort"...
...5 timepoints Ã— 8 zones = 40 rows
```

---

## ğŸš¨ Troubleshooting

### "building_simulation_data.csv not found"
**Solution:** Run `python simulate_building_data.py` first

### "zone_forecast_data.csv not found"
**Solution:** Run `python generate_zone_data.py 30` first

### Simulation takes too long
**Solution:** Reduce days: `python simulate_building_data.py 7`

### Want different analysis times
**Solution:** Edit `target_hours` in `main_multizone.py`

---

**Quick Start:**
```bash
python generate_zone_data.py 30
python simulate_building_data.py 30
python main_multizone.py
```
